import org.junit.jupiter.api.Test;

import java.util.*;

import static org.junit.jupiter.api.Assertions.assertEquals;

public class Esolang_Interpreters2 {
    //https://www.codewars.com/kata/58678d29dbca9a68d80000d7/java
    public static class Smallfuck {
        public static String interpreter(String code, String tape) {
//            System.out.println("Code: " + code + " tape: " + tape);
            StringBuilder result = new StringBuilder(tape);
            int i = 0;
            for (int k = 0; k < code.length() && i >= 0 && i < tape.length(); k++) {
                char value = result.charAt(i);
                switch (code.charAt(k)) {
                    case '*':
                        value = value == '0' ? '1' : '0';
                        result.replace(i, i + 1, String.valueOf(value));
                        break;
                    case '>':
                        i++;
                        break;
                    case '<':
                        i--;
                        break;
                    case '[':
                        if(value == '0') {
                            Stack<Character> stack = new Stack<>();
                            while (k + 1 < code.length()) {
                                char command = code.charAt(++k);
                                if(command == ']') {
                                    if (stack.isEmpty())
                                        break;
                                    else
                                        stack.pop();
                                }else if(command == '[')
                                    stack.add(command);
                            }
                        }
                        break;
                    case ']':
                        if(value == '1'){
                            Stack<Character> stack = new Stack<>();
                            while (k > 0){
                                char command = code.charAt(--k);
                                if(command == '[') {
                                    if (stack.isEmpty())
                                        break;
                                    else
                                        stack.pop();
                                } else if(command == ']')
                                    stack.push(command);
                            }
                        }
                        break;
                }
            }
            return result.toString();
        }
    }
    @Test
    public void testExamples() {
//         Flips the leftmost cell of the tape
        assertEquals("10101100", Smallfuck.interpreter("*", "00101100"));

        // Flips the second and third cell of the tape
        assertEquals("01001100", Smallfuck.interpreter(">*>*", "00101100"));
//
//        // Flips all the bits in the tape
        assertEquals("11010011", Smallfuck.interpreter("*>*>*>*>*>*>*>*", "00101100"));
//
//        // Flips all the bits that are initialized to 0
        assertEquals("11111111", Smallfuck.interpreter("*>*>>*>>>*>*", "00101100"));
//
//        // Goes somewhere to the right of the tape and then flips all bits that are initialized to 1, progressing leftwards through the tape
        assertEquals("00000000", Smallfuck.interpreter(">>>>>*<*<<*", "00101100"));
    }

    @Test
    public void failingTests(){

//        assertEquals("1001101000000111", Smallfuck.interpreter("*>>>*>*>>*>>>>>>>*>*>*>*>>>**>>**", "0000000000000000"));

        //[1100101011000111]
        //[0000000110111110]

                                                            //                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            1100101011000111
                                            //0111011111011101100001111100001101111011110101100110001011100010011110000001101000000111011001111101010010101101011100011101110001100001111011000100111110110111101111100010100001011111011000000001000011011010100100101011100010001110000101001000111101000010010000110110011001101000101111110001110011111101111110111011000001010000111110110010001001010001110111100101010011000000010001010010001001010111111100111100100001110101110101101101110000001010101010111100111111000010100000111001110010010000000110111110111111011000101111100001110110001110010100111001000100110100101000110110100100010011100010011000011000100001101000010010110011000001001101001000100001111100000101000111001111010010101001100000101001101110111011110110100100101101010001111101000000000111101101010101000010010011110110111010101010011100001011100110011111001111111101101000110011101100001010010000111110000010001101000001110101000110110001101111001011011101001111100001100011110111000111110010001111110011000100001010000100100011

//        assertEquals(                "0111011111011101100001111100001101111011110101100110001011100010011110000001101000000111011001111101010010101101011100011101110001100001111011000100111110110111101111100010100001011111011000000001000011011010100100101011100010001110000101001000111101000010010000110110011001101000101111110001110011111101111110111011000001010000111110110010001001010001110111100101010011000000010001010010001001010111111100111100100001110101110101101101110000001010101010111100111111000010100000111001110010011100101011000111111111011000101111100001110110001110010100111001000100110100101000110110100100010011100010011000011000100001101000010010110011000001001101001000100001111100000101000111001111010010101001100000101001101110111011110110100100101101010001111101000000000111101101010101000010010011110110111010101010011100001011100110011111001111111101101000110011101100001010010000111110000010001101000001110101000110110001101111001011011101001111100001100011110111000111110010001111110011000100001010000100100011"
//                , Smallfuck.interpreter(">>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>*<*<<<**>**<<*<><*<*<*<>><**<<****<**>**>>><<>>*><*<**>>>**>>*><>><><><><**><*<*<<<><>*<>*><<<*<>>*<<**<*<<><>*****>>><*>*><>*<****>*><<<*><>>>>><>>><><>**<<<*><<<<<>**<<<*>>**<*<**>>>><>>*<<<>>**<<>><<<><<<*>>><<<>>*<**<>>*>><**>***>**<<**><><>*<>*>>**<<>*>*<<*<*<<>>><>*>>>*<><*><*>*<<<><*>>>***<*<*>>><>*>>**<<>>><**>><*>**<<**<<<<>><**<>><>>*<*><<>**<<<*><>><<*<*>>>><*<>**><<***<>>*><*><>*<<****><<**<><>*><******>><<>*><*>>>>><*>*<*<>>>><*>*<*<<>*<*<>*><****><<>*<<*>><<*<<>*>><>>**<***<>*>**>>**>*<*>*>*>*>*<><><<*<>*>><<*<><<>><<<<*><*<<**<><>>><<<<*><><>>*>*>><><<<**><<*<>><><>>><*<<<<*<<<<*>><**<*<<<><>>><><*>>*><><<<><<**>><>**<*>>>***><****<<>*>><*>*>**<<<<>*><<*>><<<>**<*"
//                                      , "0111011111011101100001111100001101111011110101100110001011100010011110000001101000000111011001111101010010101101011100011101110001100001111011000100111110110111101111100010100001011111011000000001000011011010100100101011100010001110000101001000111101000010010000110110011001101000101111110001110011111101111110111011000001010000111110110010001001010001110111100101010011000000010001010010001001010111111100111100100001110101110101101101110000001010101010111100111111000010100000111001110010011111111001000001001111011000101111100001110110001110010100111001000100110100101000110110100100010011100010011000011000100001101000010010110011000001001101001000100001111100000101000111001111010010101001100000101001101110111011110110100100101101010001111101000000000111101101010101000010010011110110111010101010011100001011100110011111001111111101101000110011101100001010010000111110000010001101000001110101000110110001101111001011011101001111100001100011110111000111110010001111110011000100001010000100100011"));

        assertEquals("1111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111"
                , Smallfuck.interpreter("*[>*]", "0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000"));
    }
}
